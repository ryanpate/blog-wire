{% extends "base.html" %}

{% block title %}{{ post.title }} - {{ config.BLOG_NAME }}{% endblock %}

{% block meta %}
<meta name="description" content="{{ post.meta_description or post.excerpt }}">
<meta name="keywords" content="{{ post.meta_keywords }}">
{% endblock %}

{% block og_meta %}
<!-- Open Graph Article -->
<meta property="og:title" content="{{ post.title }}">
<meta property="og:description" content="{{ post.meta_description or post.excerpt }}">
<meta property="og:url" content="https://{{ config.BLOG_DOMAIN }}/blog/{{ post.slug }}">
<meta property="og:type" content="article">
{% if post.featured_image_url %}
<meta property="og:image" content="{{ post.featured_image_url }}">
<meta property="og:image:alt" content="{{ post.title }}">
{% endif %}
<meta property="article:published_time" content="{{ post.published_at.isoformat() }}">
{% if post.updated_at %}
<meta property="article:modified_time" content="{{ post.updated_at.isoformat() }}">
{% endif %}
<meta property="article:author" content="{{ config.SITE_AUTHOR }}">
{% if post.meta_keywords %}
{% for keyword in post.meta_keywords.split(',')[:5] %}
<meta property="article:tag" content="{{ keyword.strip() }}">
{% endfor %}
{% endif %}

<!-- Twitter Card -->
<meta name="twitter:title" content="{{ post.title }}">
<meta name="twitter:description" content="{{ post.meta_description or post.excerpt }}">
{% if post.featured_image_url %}
<meta name="twitter:image" content="{{ post.featured_image_url }}">
<meta name="twitter:image:alt" content="{{ post.title }}">
{% endif %}
{% endblock %}

{% block head_extra %}
<!-- Preload LCP image -->
{% if post.featured_image_url %}
<link rel="preload" as="image" href="{{ post.featured_image_url }}" fetchpriority="high">
{% endif %}

<!-- Schema.org JSON-LD -->
<script type="application/ld+json">
{{ schema_markup|safe }}
</script>
{% endblock %}

{% block content %}
<!-- Breadcrumb Navigation -->
<nav class="breadcrumb" aria-label="Breadcrumb">
    <ol itemscope itemtype="https://schema.org/BreadcrumbList">
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <a href="/" itemprop="item">
                <span itemprop="name">Home</span>
            </a>
            <meta itemprop="position" content="1" />
        </li>
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <span itemprop="name">{{ post.title }}</span>
            <meta itemprop="position" content="2" />
        </li>
    </ol>
</nav>

<article class="blog-post" itemscope itemtype="https://schema.org/BlogPosting">
    <header class="post-header">
        <h1 class="post-title" itemprop="headline">{{ post.title }}</h1>

        <div class="post-meta">
            <time datetime="{{ post.published_at.isoformat() }}" itemprop="datePublished">
                {{ post.published_at|format_date }}
            </time>
            {% if post.updated_at %}
            <meta itemprop="dateModified" content="{{ post.updated_at.isoformat() }}">
            {% endif %}
            <span class="separator">•</span>
            <span class="reading-time">{{ post.word_count|reading_time }}</span>
            <span class="separator">•</span>
            <span class="view-count">{{ post.view_count }} views</span>
        </div>
        <meta itemprop="author" content="{{ config.SITE_AUTHOR }}">
        <meta itemprop="publisher" content="{{ config.BLOG_NAME }}">
    </header>

    {% if config.ADSENSE_ENABLED %}
    <!-- AdSense Top Banner Ad -->
    <div class="ad-container ad-top">
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="{{ config.ADSENSE_CLIENT_ID }}"
             data-ad-slot="7285922677"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
        <script>
             (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
    </div>
    {% endif %}

    {% if post.featured_image_url %}
    <div class="post-featured-image">
        <img src="{{ post.featured_image_url }}"
             alt="Featured image for {{ post.title }} - {{ post.meta_description[:100] if post.meta_description else post.excerpt[:100] }}"
             width="800"
             height="800"
             fetchpriority="high"
             title="{{ post.title }}">
    </div>
    {% endif %}

    {% if config.ADSENSE_ENABLED %}
    <!-- AdSense Middle Banner Ad -->
    <div class="ad-container ad-in-article">
        <ins class="adsbygoogle"
             style="display:block; text-align:center;"
             data-ad-layout="in-article"
             data-ad-format="fluid"
             data-ad-client="{{ config.ADSENSE_CLIENT_ID }}"
             data-ad-slot="4186058569"></ins>
        <script>
             (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
    </div>
    {% endif %}

    <div class="post-content" itemprop="articleBody">
        {{ html_content|safe }}
    </div>

    {% if related_posts %}
    <!-- Related Posts Section -->
    <section class="related-posts">
        <h2>Related Articles You May Like</h2>
        <div class="related-posts-grid">
            {% for related in related_posts %}
            <article class="related-post-card">
                {% if related.featured_image_url %}
                <div class="related-post-image">
                    <a href="{{ url_for('blog_post', slug=related.slug) }}">
                        <img src="{{ related.featured_image_url }}"
                             alt="{{ related.title }}"
                             loading="lazy">
                    </a>
                </div>
                {% endif %}
                <div class="related-post-content">
                    <h3>
                        <a href="{{ url_for('blog_post', slug=related.slug) }}">{{ related.title }}</a>
                    </h3>
                    <p class="related-post-excerpt">{{ related.excerpt[:120] }}...</p>
                </div>
            </article>
            {% endfor %}
        </div>
    </section>
    {% endif %}

    {% if config.ADSENSE_ENABLED %}
    <!-- AdSense Bottom Banner Ad -->
    <div class="ad-container ad-bottom">
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="{{ config.ADSENSE_CLIENT_ID }}"
             data-ad-slot="6571606806"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
        <script>
             (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
    </div>
    {% endif %}

    <footer class="post-footer">
        <div class="post-tags">
            {% if post.meta_keywords %}
                {% for keyword in post.meta_keywords.split(',') %}
                <span class="tag">{{ keyword.strip() }}</span>
                {% endfor %}
            {% endif %}
        </div>

        <div class="post-navigation">
            <a href="/" class="back-home">← Back to Home</a>
        </div>
    </footer>
</article>
{% endblock %}
